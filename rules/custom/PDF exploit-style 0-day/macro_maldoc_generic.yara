rule Macro_Maldoc_Generic
{
    meta:
        description = "Suspicious Office document macros (generic)"
        author = "rakavi"
        severity = "high"

    strings:
        $vba1 = "VBA" ascii nocase
        $auto = "AutoOpen" ascii nocase
        $doc_open = "Document_Open" ascii nocase
        $shell = "Shell(" ascii nocase
        $psexec = "WScript.Shell" ascii nocase
        $url = "http://" ascii nocase
        $url2 = "https://" ascii nocase

    condition:
        // Likely Office or OLE file
        uint16(0) == 0xD0CF or uint32(0) == 0x504B0304 and
        ( ($vba1 and ($auto or $doc_open)) or
          (1 of ($url*) and $shell) or
          (2 of ($url* $psexec $shell))
        )
}
